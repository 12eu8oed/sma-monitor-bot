# 🤖 SMA 모니터 봇

바이낸스 선물 시장을 위한 실시간 SMA (단순 이동 평균) 골든/데드크로스 모니터링 봇입니다. 텔레그램을 통해 양방향 명령어가 가능합니다.

---

## 🎯 기획 및 핵심 기능 명세 (PRD)
_"코딩을 몰라도 이해할 수 있는 봇의 본질"_

**1. 이 봇은 왜 만들어졌나요? (개발 목적)**
가상화폐 트레이딩을 하다 보면 24시간 내내 차트를 쳐다볼 수 없습니다. 자신이 원하는 특정 조건(예: 이동평균선이 모두 정배열이 될 때, 혹은 내가 그어둔 추세선을 뚫고 올라갔을 때)이 올 때까지 기다리는 지루함을 없애고, **조건이 달성되는 정확한 그 순간 내 폰으로 즉시 알람을 울려주는 "나만의 개인 비서"**를 목적으로 기획되었습니다.

**2. 핵심 기능 3가지 (Core Features)**
* **🔍 이평선 감시자 (SMA 정배열/역배열 알람)**
  * 단기, 중기, 장기 이동평균선(7, 25, 99)이 내가 원하는 순서대로 딱 정렬되었을 때(예: 완벽한 상승장 초입) 알람을 보내줍니다.
* **📏 내 맘대로 선 긋기 (대각선 추세선 돌파 알람)**
  * 트레이딩뷰에서 직접 선을 긋듯이, 봇에게 "언제 얼마부터, 언제 얼마까지 이은 선을 위로 뚫으면 알려줘" 라고 시키면, 복잡한 수학 계산을 통해 캔들이 그 선을 뚫고 마감될 때 정확히 알람을 줍니다.
* **📱 카톡처럼 대화하는 원격 제어 (텔레그램 컨트롤)**
  * 봇을 켜두기만 하면, 밖에서도 폰으로 텔레그램을 열어 `15m`(15분봉으로 바꿔), `status`(지금 작동 잘하고 있어?), `report off`(알람 좀 꺼봐) 처럼 봇과 대화하며 설정값을 마음대로 바꿀 수 있습니다.

**3. 어떤 원리로 작동하나요?**
봇은 바이낸스 거래소와 1분~1시간 간격으로 계속 통신하며 최신 가격 데이터를 가져옵니다. 차트가 중간에 휩쏘(속임수)를 주는 것에 당하지 않기 위해, **반드시 해당 시간의 캔들(봉)이 완전히 "마감"되는 시각(예: 정각, 15분, 30분, 45분)에만 계산을 수행**하고 알람을 주는 것이 가장 큰 특징입니다.

## 🚀 주요 기능
- **실시간 모니터링**: BTC, ETH, XRP, SOL에 대해 SMA 기간(7, 25, 99)을 추적합니다.
- **대화형 명령어**: 모든 기능을 텔레그램을 통해 제어할 수 있습니다.
- **중복 실행 방지**: 파일 잠금 기능을 사용하여 여러 인스턴스가 동시에 실행되는 것을 방지합니다.
- **동적 주기 설정**: 보고 주기를 즉석에서 조정할 수 있습니다.
- **표준화된 명령어**: 신뢰할 수 있는 영어 명령어와 사용자 친화적인 한국어 인터페이스를 제공합니다.

## 🛠 설정 방법

### 1. 사전 요구 사항
- Python 3.10 이상
- 텔레그램 봇 ( @BotFather를 통해 생성)

### 2. 설치
```bash
# 필수 라이브러리 설치
pip install ccxt pandas requests python-dotenv
```

### 3. 환경 설정
`.env.template` 파일을 `.env`로 복사하고 인증 정보를 입력하세요:
```bash
TELEGRAM_BOT_TOKEN=여기에_봇_토큰_입력
TELEGRAM_CHAT_ID=여기에_채팅_ID_입력
```

### 4. 봇 실행
```bash
python sma_monitor.py
```

## 🤖 명령어 가이드

### 📊 리포트 설정
- `report on/off`: 리포트 활성화/비활성화
- `interval [초]`: 리포트 간격 설정 (예: `interval 60`)

### 🎯 타겟 알림 (이평선 & 추세선)
- `alert [번호]`: 특정 배열 알림 설정 (1-6)
- `alert off`: 타겟 알림 비활성화
- `trend [코인] [월/일] [시:분] [가격] [월/일] [시:분] [가격] [up/down]`: 지정한 두 점을 이은 추세선 돌파 알람 설정
  - 예시: `trend btc 02/24 09:00 90000 02/25 09:00 95000 up`
- `trend off [코인]`: 특정 코인의 추세선 알람 끄기

### ⚙️ 기타 명령어
- `status`: 현재 설정 확인
- `now`: 즉시 상황 보고서 전송
- `help`: 이 가이드 표시

### 🕒 타임프레임
지원되는 타임프레임을 입력하여 변경: `1m`, `3m`, `5m`, `15m`, `30m`, `1h`, `2h`, `4h`, `6h`, `8h`, `12h`, `1d`.

## 🔄 최근 업데이트 (교차 플랫폼 지원)

### 1. 윈도우 호환성
- **파일 잠금**: 윈도우에서 중복 실행을 방지하기 위해 Unix 전용 `fcntl` 대신 `msvcrt.locking`을 사용하도록 수정되었습니다.
- **콘솔 인코딩**: 윈도우 터미널에서 이모지가 정상적으로 표시되도록 표준 출력을 UTF-8 인코딩으로 강제 설정했습니다.

### 2. 멀티 OS 지원
- 운영체제(Windows/macOS/Linux)를 자동으로 감지하여 코드 수정 없이도 각 OS에 맞는 시스템 레벨 함수(예: 파일 잠금)를 적용하도록 리팩토링되었습니다.

---

## 📄 라이선스
MIT License
